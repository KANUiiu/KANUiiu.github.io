// 車站資料
const stations = [
    { name: "基隆站", lat: 25.1323018, lng: 121.7394664 },
    { name: "三坑站", lat: 25.1230089, lng: 121.7418331 },
    { name: "八堵站", lat: 25.1083342, lng: 121.7290544 },
    { name: "七堵站", lat: 25.0934531, lng: 121.713928 },
    { name: "百福站", lat: 25.0779244, lng: 121.693623 },
    { name: "五堵站", lat: 25.077857, lng: 121.66763 },
    { name: "汐止站", lat: 25.068316, lng: 121.6617346 },
    { name: "汐科站", lat: 25.062563, lng: 121.6466505 },
    { name: "南港站", lat: 25.053216, lng: 121.6070578 },
    { name: "松山站", lat: 25.0491921, lng: 121.5779143 },
    { name: "臺北站", lat: 25.0479239, lng: 121.517081 },
    { name: "萬華站", lat: 25.0333965, lng: 121.5004388 },
    { name: "板橋站", lat: 25.0140513, lng: 121.463815 },
    { name: "浮洲站", lat: 25.0041922, lng: 121.444737 },
    { name: "樹林站", lat: 24.9914074, lng: 121.4246008 },
    { name: "南樹林站", lat: 24.9804377, lng: 121.4088524 },
    { name: "山佳站", lat: 24.9724808, lng: 121.392614 },
    { name: "鶯歌站", lat: 24.95462, lng: 121.356026 },
    { name: "桃園站", lat: 24.989206, lng: 121.313549 },
    { name: "內壢站", lat: 24.9744782, lng: 121.2633953 },
    { name: "中壢站", lat: 24.9534545, lng: 121.2257365 },
    { name: "埔心站", lat: 24.9192082, lng: 121.1838019 },
    { name: "楊梅站", lat: 24.9108316, lng: 121.1456848 },
    { name: "富岡站", lat: 24.9343559, lng: 121.0815085 },
    { name: "北湖站", lat: 24.922226, lng: 121.055736 },
    { name: "湖口站", lat: 24.9028648, lng: 121.0441227 },
    { name: "新豐站", lat: 24.8699365, lng: 120.9965875 },
    { name: "竹北站", lat: 24.8391207, lng: 121.0095335 },
    { name: "北新竹站", lat: 24.808765, lng: 120.9838244 },
    { name: "新竹站", lat: 24.8016432, lng: 120.9716955 },
    { name: "三姓橋站", lat: 24.787326, lng: 120.928405 },
    { name: "香山站", lat: 24.7631278, lng: 120.9138744 },
    { name: "崎頂站", lat: 24.7228788, lng: 120.8718921 },
    { name: "竹南站", lat: 24.6866106, lng: 120.8806984 },
    { name: "造橋站", lat: 24.6418626, lng: 120.867194 },
    { name: "豐富站", lat: 24.6011288, lng: 120.8235487 },
    { name: "苗栗站", lat: 24.5700216, lng: 120.8225292 },
    { name: "南勢站", lat: 24.522753, lng: 120.793193 },
    { name: "銅鑼站", lat: 24.4863398, lng: 120.7861726 },
    { name: "三義站", lat: 24.4206203, lng: 120.7739306 },
    { name: "泰安站", lat: 24.331292, lng: 120.741816 },
    { name: "后里站", lat: 24.309312, lng: 120.732893 },
    { name: "豐原站", lat: 24.254112, lng: 120.722917 },
    { name: "潭子站", lat: 24.2132325, lng: 120.7053569 },
    { name: "太原站", lat: 24.1666822, lng: 120.7000847 },
    { name: "臺中站", lat: 24.136781, lng: 120.685008 },
    { name: "大慶站", lat: 24.118876, lng: 120.647897 },
    { name: "烏日站", lat: 24.1086923, lng: 120.6224719 },
    { name: "新烏日站", lat: 24.1100254, lng: 120.6162073 },
    { name: "成功站", lat: 24.1107677, lng: 120.6004956 },
    { name: "談文站", lat: 24.6564147, lng: 120.8582416 },
    { name: "大山站", lat: 24.645645, lng: 120.803778 },
    { name: "後龍站", lat: 24.6162121, lng: 120.7873071 },
    { name: "龍港站", lat: 24.611683, lng: 120.758142 },
    { name: "白沙屯站", lat: 24.564797, lng: 120.7081978 },
    { name: "新埔站", lat: 24.54018, lng: 120.695179 },
    { name: "通霄站", lat: 24.4914035, lng: 120.6784246 },
    { name: "苑裡站", lat: 24.443426, lng: 120.651494 },
    { name: "日南站", lat: 24.3780659, lng: 120.6541189 },
    { name: "大甲站", lat: 24.34443, lng: 120.6270172 },
    { name: "臺中港站", lat: 24.304388, lng: 120.602303 },
    { name: "清水站", lat: 24.2636239, lng: 120.569178 },
    { name: "沙鹿站", lat: 24.2370445, lng: 120.5576269 },
    { name: "龍井站", lat: 24.1972272, lng: 120.5443041 },
    { name: "大肚站", lat: 24.1550185, lng: 120.5425336 },
    { name: "追分站", lat: 24.1208194, lng: 120.5695894 },
    { name: "彰化站", lat: 24.0816657, lng: 120.5385394 },
    { name: "花壇站", lat: 24.0249965, lng: 120.5373997 },
    { name: "大村站", lat: 23.9900528, lng: 120.5606453 },
    { name: "員林站", lat: 23.9593465, lng: 120.5699606 },
    { name: "永靖站", lat: 23.9281475, lng: 120.5716724 },
    { name: "社頭站", lat: 23.8957104, lng: 120.5808001 },
    { name: "田中站", lat: 23.857685, lng: 120.583564 },
    { name: "二水站", lat: 23.8131501, lng: 120.618115 },
    { name: "林內站", lat: 23.7596808, lng: 120.614987 },
    { name: "石榴站", lat: 23.725819, lng: 120.577977 },
    { name: "斗六站", lat: 23.7124606, lng: 120.54327 },
    { name: "斗南站", lat: 23.6729716, lng: 120.4808407 },
    { name: "石龜站", lat: 23.6386539, lng: 120.4732056 },
    { name: "大林站", lat: 23.6010764, lng: 120.4558391 },
    { name: "民雄站", lat: 23.5550395, lng: 120.4316513 },
    { name: "嘉北站", lat: 23.500685, lng: 120.451295 },
    { name: "嘉義站", lat: 23.4793059, lng: 120.4422923 },
    { name: "水上站", lat: 23.433976, lng: 120.399706 },
    { name: "南靖站", lat: 23.406972, lng: 120.3853425 },
    { name: "後壁站", lat: 23.366247, lng: 120.360603 },
    { name: "新營站", lat: 23.3067319, lng: 120.323055 },
    { name: "柳營站", lat: 23.27762, lng: 120.322519 },
    { name: "林鳳營站", lat: 23.242592, lng: 120.320973 },
    { name: "隆田站", lat: 23.1926666, lng: 120.318898 },
    { name: "拔林站", lat: 23.172291, lng: 120.321185 },
    { name: "善化站", lat: 23.1333235, lng: 120.3065509 },
    { name: "南科站", lat: 23.100596, lng: 120.307701 },
    { name: "新市站", lat: 23.0643755, lng: 120.2944406 },
    { name: "永康站", lat: 23.0383377, lng: 120.2535236 },
    { name: "大橋站", lat: 23.0193991, lng: 120.2244201 },
    { name: "臺南站", lat: 22.9971443, lng: 120.2129662 },
    { name: "保安站", lat: 22.9329397, lng: 120.2315935 },
    { name: "仁德站", lat: 22.9215274, lng: 120.2432267 },
    { name: "中洲站", lat: 22.909584, lng: 120.249932 },
    { name: "大湖站", lat: 22.8802741, lng: 120.2533872 },
    { name: "路竹站", lat: 22.8547588, lng: 120.265653 },
    { name: "岡山站", lat: 22.7922708, lng: 120.3000191 },
    { name: "橋頭站", lat: 22.7599698, lng: 120.3105702 },
    { name: "楠梓站", lat: 22.7270354, lng: 120.3243707 },
    { name: "新左營站", lat: 22.6875442, lng: 120.3067878 },
    { name: "左營站", lat: 22.675204, lng: 120.2947934 },
    { name: "高雄站", lat: 22.6396198, lng: 120.3021106 },
    { name: "鳳山站", lat: 22.631284, lng: 120.357683 },
    { name: "後庄站", lat: 22.6400667, lng: 120.3911254 },
    { name: "九曲堂站", lat: 22.6595711, lng: 120.4213296 },
    { name: "六塊厝站", lat: 22.665987, lng: 120.464996 },
    { name: "屏東站", lat: 22.669306, lng: 120.486203 },
    { name: "暖暖站", lat: 25.1022821, lng: 121.740329 },
    { name: "四腳亭站", lat: 25.1027508, lng: 121.7618869 },
    { name: "瑞芳站", lat: 25.1089277, lng: 121.8061486 },
    { name: "猴硐站", lat: 25.0870094, lng: 121.8274239 },
    { name: "三貂嶺站", lat: 25.0655443, lng: 121.8225588 },
    { name: "牡丹站", lat: 25.058768, lng: 121.851999 },
    { name: "雙溪站", lat: 25.0386122, lng: 121.8658396 },
    { name: "貢寮站", lat: 25.0219664, lng: 121.9093995 },
    { name: "福隆站", lat: 25.0163397, lng: 121.9448946 },
    { name: "石城站", lat: 24.9783344, lng: 121.9451914 },
    { name: "大里站", lat: 24.9667986, lng: 121.9224961 },
    { name: "大溪站", lat: 24.9384235, lng: 121.8898732 },
    { name: "龜山站", lat: 24.9048183, lng: 121.8688782 },
    { name: "外澳站", lat: 24.8837032, lng: 121.8457576 },
    { name: "頭城站", lat: 24.8589758, lng: 121.8225558 },
    { name: "頂埔站", lat: 24.843998, lng: 121.8092075 },
    { name: "礁溪站", lat: 24.8270345, lng: 121.7753536 },
    { name: "四城站", lat: 24.7868018, lng: 121.7627275 },
    { name: "宜蘭站", lat: 24.7545124, lng: 121.7582529 },
    { name: "二結站", lat: 24.7052671, lng: 121.774131 },
    { name: "中里站", lat: 24.694166, lng: 121.775256 },
    { name: "羅東站", lat: 24.6779285, lng: 121.7746293 },
    { name: "冬山站", lat: 24.6362965, lng: 121.7921071 },
    { name: "新馬站", lat: 24.6153953, lng: 121.8229 },
    { name: "蘇澳新站", lat: 24.6090239, lng: 121.82703 },
    { name: "蘇澳站", lat: 24.5951807, lng: 121.8514401 },
    { name: "永樂站", lat: 24.5684172, lng: 121.8445641 },
    { name: "東澳站", lat: 24.518281, lng: 121.830705 },
    { name: "南澳站", lat: 24.4633961, lng: 121.8009262 },
    { name: "武塔站", lat: 24.4486736, lng: 121.7760368 },
    { name: "漢本站", lat: 24.3354282, lng: 121.7683548 },
    { name: "和平站", lat: 24.2982959, lng: 121.7533456 },
    { name: "和仁站", lat: 24.2481897, lng: 121.7294026 },
    { name: "崇德站", lat: 24.1693952, lng: 121.6543068 },
    { name: "新城站", lat: 24.1275238, lng: 121.640866 },
    { name: "景美站", lat: 24.090317, lng: 121.610786 },
    { name: "北埔站", lat: 24.0259577, lng: 121.6028403 },
    { name: "花蓮站", lat: 23.9928678, lng: 121.6009927 },
    { name: "吉安站", lat: 23.9667376, lng: 121.5853166 },
    { name: "志學站", lat: 23.9074936, lng: 121.5294366 },
    { name: "平和站", lat: 23.8827741, lng: 121.520485 },
    { name: "壽豐站", lat: 23.869016, lng: 121.510633 },
    { name: "豐田站", lat: 23.848475, lng: 121.496168 },
    { name: "南平站", lat: 23.7822757, lng: 121.4582804 },
    { name: "鳳林站", lat: 23.74634, lng: 121.4470243 },
    { name: "萬榮站", lat: 23.711978, lng: 121.419067 },
    { name: "光復站", lat: 23.666293, lng: 121.4211678 },
    { name: "大富站", lat: 23.605688, lng: 121.3896245 },
    { name: "富源站", lat: 23.5802685, lng: 121.3801225 },
    { name: "瑞穗站", lat: 23.4973759, lng: 121.3768412 },
    { name: "三民站", lat: 23.424535, lng: 121.345403 },
    { name: "玉里站", lat: 23.3315175, lng: 121.311726 },
    { name: "東里站", lat: 23.2723086, lng: 121.3041814 },
    { name: "東竹站", lat: 23.226025, lng: 121.278481 },
    { name: "富里站", lat: 23.1791319, lng: 121.2486917 },
    { name: "池上站", lat: 23.1261582, lng: 121.2193902 },
    { name: "海端站", lat: 23.1029344, lng: 121.1768294 },
    { name: "關山站", lat: 23.0456654, lng: 121.164373 },
    { name: "瑞和站", lat: 22.979985, lng: 121.15584 },
    { name: "瑞源站", lat: 22.953923, lng: 121.15807 },
    { name: "鹿野站", lat: 22.9124694, lng: 121.1370039 },
    { name: "山里站", lat: 22.862046, lng: 121.138031 },
    { name: "臺東站", lat: 22.7946607, lng: 121.1234431 },
    { name: "歸來站", lat: 22.652189, lng: 120.502952 },
    { name: "麟洛站", lat: 22.634819, lng: 120.514368 },
    { name: "西勢站", lat: 22.616433, lng: 120.5266971 },
    { name: "竹田站", lat: 22.5864608, lng: 120.5418585 },
    { name: "潮州站", lat: 22.550086, lng: 120.53642 },
    { name: "崁頂站", lat: 22.512921, lng: 120.511117 },
    { name: "南州站", lat: 22.4920584, lng: 120.5117382 },
    { name: "鎮安站", lat: 22.457927, lng: 120.511321 },
    { name: "林邊站", lat: 22.4314061, lng: 120.5153762 },
    { name: "佳冬站", lat: 22.4140869, lng: 120.5477418 },
    { name: "東海站", lat: 22.398968, lng: 120.572356 },
    { name: "枋寮站", lat: 22.3680186, lng: 120.5950975 },
    { name: "加祿站", lat: 22.330971, lng: 120.624621 },
    { name: "內獅站", lat: 22.297838, lng: 120.643774 },
    { name: "枋山站", lat: 22.267067, lng: 120.659647 },
    { name: "古莊站", lat: 22.3455088, lng: 120.8780786 },
    { name: "大武站", lat: 22.365217, lng: 120.9008 },
    { name: "瀧溪站", lat: 22.463806, lng: 120.938037 },
    { name: "金崙站", lat: 22.531488, lng: 120.9672394 },
    { name: "太麻里站", lat: 22.618823, lng: 121.005007 },
    { name: "知本站", lat: 22.7314629, lng: 121.0587551 },
    { name: "康樂站", lat: 22.7636935, lng: 121.0941177 },
    { name: "八斗子站", lat: 25.135311, lng: 121.8028572 },
    { name: "海科館站", lat: 25.13838, lng: 121.799062 },
    { name: "大華站", lat: 25.049964, lng: 121.797847 },
    { name: "十分站", lat: 25.0430998, lng: 121.7767203 },
    { name: "望古站", lat: 25.0345984, lng: 121.7537404 },
    { name: "嶺腳站", lat: 25.030052, lng: 121.74804 },
    { name: "平溪站", lat: 25.025789, lng: 121.7410565 },
    { name: "菁桐站", lat: 25.0246184, lng: 121.7284449 },
    { name: "千甲站", lat: 24.8066257, lng: 121.0033786 },
    { name: "新莊站", lat: 24.7880283, lng: 121.0219477 },
    { name: "竹中站", lat: 24.7814701, lng: 121.030687 },
    { name: "上員站", lat: 24.777831, lng: 121.055699 },
    { name: "榮華站", lat: 24.748359, lng: 121.08331 },
    { name: "竹東站", lat: 24.7378224, lng: 121.0943482 },
    { name: "橫山站", lat: 24.7205632, lng: 121.1165462 },
    { name: "九讚頭站", lat: 24.7206375, lng: 121.1362146 },
    { name: "合興站", lat: 24.7167094, lng: 121.1543901 },
    { name: "富貴站", lat: 24.715543, lng: 121.167371 },
    { name: "內灣站", lat: 24.7053022, lng: 121.1825562 },
    { name: "六家站", lat: 24.807528, lng: 121.0393001 },
    { name: "源泉站", lat: 23.797054, lng: 120.639857 },
    { name: "濁水站", lat: 23.8362337, lng: 120.7043512 },
    { name: "龍泉站", lat: 23.833556, lng: 120.737912 },
    { name: "集集站", lat: 23.826451, lng: 120.784891 },
    { name: "水里站", lat: 23.8184559, lng: 120.853323 },
    { name: "車埕站", lat: 23.8326366, lng: 120.8657454 },
    { name: "長榮大學站", lat: 22.9099639, lng: 120.2714247 },
    { name: "沙崙站", lat: 22.923848, lng: 120.286403 }
];

// 找出最近的車站
function findNearestStation() {
    const address = document.getElementById("address").value;

    // 使用 Nominatim API 將地址轉換為經緯度
    const geocodeUrl = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(address)}`;

    fetch(geocodeUrl)
        .then(response => response.json())
        .then(data => {
            if (data.length > 0) {
                const userLocation = {
                    lat: parseFloat(data[0].lat),
                    lng: parseFloat(data[0].lon)
                };

                let nearestStation = null;
                let shortestDistance = Infinity;

                // 計算與每個車站的距離
                stations.forEach(station => {
                    const stationLocation = turf.point([station.lng, station.lat]);
                    const userPoint = turf.point([userLocation.lng, userLocation.lat]);

                    const distance = turf.distance(userPoint, stationLocation, { units: 'kilometers' });

                    if (distance < shortestDistance) {
                        shortestDistance = distance;
                        nearestStation = station;
                    }
                });

                // 顯示結果
                document.getElementById("result").innerHTML = `距離最近的台鐵車站是${nearestStation.name}</br>距離大約 ${shortestDistance.toFixed(2)} 公里。`;
            } else {
                document.getElementById("result").innerHTML = "嗨！請輸入縣市、鄉鎮區、ＸＸ路即可查詢。</br>巷弄及幾號將在誤差範圍內，不影響結果。";
            }
        })
        .catch(error => {
            document.getElementById("result").innerHTML = "系統錯誤";
            console.error(error);
        });
}